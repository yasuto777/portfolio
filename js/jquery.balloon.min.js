!function(e){"use strict";function t(){this.initialize.apply(this,arguments)}function o(o,i,s){function a(e,t,o,i,n){var s=Math.round(i/1.7320508);t.inactive()["setBorder"+o.camel.pos.f](i)["setBorder"+o.camel.pos.c1](s)["setBorder"+o.camel.pos.c2](s)["set"+o.camel.pos.p1](o.isTopLeft?-i:e.inner[o.size.p])["set"+o.camel.pos.c1](e.inner[o.size.c]/2-s).active().$.css("border-"+o.pos.f+"-color",n)}i.stop(!0,!0);var r,l,p={position:"absolute",height:"0",width:"0",border:"solid 0 transparent"},c=new t(o),d=new t(i);if(d.setTop(-s.offsetY+(s.position&&s.position.indexOf("top")>=0?c.top-d.height:s.position&&s.position.indexOf("bottom")>=0?c.bottom:c.center.top-d.height/2)),d.setLeft(s.offsetX+(s.position&&s.position.indexOf("left")>=0?c.left-d.width:s.position&&s.position.indexOf("right")>=0?c.right:c.center.left-d.width/2)),s.tipSize>0){i.data("outerTip")&&(i.data("outerTip").remove(),i.removeData("outerTip")),i.data("innerTip")&&(i.data("innerTip").remove(),i.removeData("innerTip")),r=new t(e("<div>").css(p).appendTo(i)),l=new t(e("<div>").css(p).appendTo(i));for(var h,u=0;u<n.pos.length;u++){if(h=n.getRelativeNames(u),d.center[h.pos.c1]>=c[h.pos.c1]&&d.center[h.pos.c1]<=c[h.pos.c2])if(u%2===0){if(d[h.pos.o]>=c[h.pos.o]&&d[h.pos.f]>=c[h.pos.f])break}else if(d[h.pos.o]<=c[h.pos.o]&&d[h.pos.f]<=c[h.pos.f])break;h=null}h?(d["set"+h.camel.pos.p1](d[h.pos.p1]+(h.isTopLeft?1:-1)*(s.tipSize-d["border"+h.camel.pos.o])),a(d,r,h,s.tipSize,i.css("border-"+h.pos.o+"-color")),a(d,l,h,s.tipSize-2*d["border"+h.camel.pos.o],i.css("background-color")),i.data("outerTip",r.$).data("innerTip",l.$)):e.each([r.$,l.$],function(){this.remove()})}}function i(t,o){var i=t.data("balloon")&&t.data("balloon").get(0);return!(i&&(i===o.relatedTarget||e.contains(i,o.relatedTarget)))}var n={};n.pos=e.extend(["top","bottom","left","right"],{camel:["Top","Bottom","Left","Right"]}),n.size=e.extend(["height","width"],{camel:["Height","Width"]}),n.getRelativeNames=function(e){var t={pos:{o:e,f:e%2===0?e+1:e-1,p1:e%2===0?e:e-1,p2:e%2===0?e+1:e,c1:2>e?2:0,c2:2>e?3:1},size:{p:2>e?0:1,c:2>e?1:0}},o={};for(var i in t){o[i]||(o[i]={});for(var s in t[i])o[i][s]=n[i][t[i][s]],o.camel||(o.camel={}),o.camel[i]||(o.camel[i]={}),o.camel[i][s]=n[i].camel[t[i][s]]}return o.isTopLeft=o.pos.o===o.pos.p1,o},function(){function o(e,t){if(null==t)return o(e,!0),o(e,!1);var i=n.getRelativeNames(t?0:2);return e[i.size.p]=e.$["outer"+i.camel.size.p](),e[i.pos.f]=e[i.pos.o]+e[i.size.p],e.center[i.pos.o]=e[i.pos.o]+e[i.size.p]/2,e.inner[i.pos.o]=e[i.pos.o]+e["border"+i.camel.pos.o],e.inner[i.size.p]=e.$["inner"+i.camel.size.p](),e.inner[i.pos.f]=e.inner[i.pos.o]+e.inner[i.size.p],e.inner.center[i.pos.o]=e.inner[i.pos.f]+e.inner[i.size.p]/2,e}var i={setBorder:function(e,t){return function(i){return this.$.css("border-"+e.toLowerCase()+"-width",i+"px"),this["border"+e]=i,this.isActive?o(this,t):this}},setPosition:function(e,t){return function(i){return this.$.css(e.toLowerCase(),i+"px"),this[e.toLowerCase()]=i,this.isActive?o(this,t):this}}};t.prototype={initialize:function(t){this.$=t,e.extend(!0,this,this.$.offset(),{center:{},inner:{center:{}}});for(var o=0;o<n.pos.length;o++)this["border"+n.pos.camel[o]]=parseInt(this.$.css("border-"+n.pos[o]+"-width"))||0;this.active()},active:function(){return this.isActive=!0,o(this),this},inactive:function(){return this.isActive=!1,this}};for(var s=0;s<n.pos.length;s++)t.prototype["setBorder"+n.pos.camel[s]]=i.setBorder(n.pos.camel[s],2>s),s%2===0&&(t.prototype["set"+n.pos.camel[s]]=i.setPosition(n.pos.camel[s],2>s))}(),e.fn.balloon=function(t){return this.one("mouseenter",function o(){var n=e(this),s=this,a=n.off("mouseenter",o).showBalloon(t).on("mouseenter",function(e){i(n,e)&&n.showBalloon()}).data("balloon");a&&a.on("mouseleave",function(t){s===t.relatedTarget||e.contains(s,t.relatedTarget)||n.hideBalloon()}).on("mouseenter",function(t){s===t.relatedTarget||e.contains(s,t.relatedTarget)||(a.stop(!0,!0),n.showBalloon())})}).on("mouseleave",function(t){var o=e(this);i(o,t)&&o.hideBalloon()})},e.fn.showBalloon=function(t){var i,n;return(t||!this.data("options"))&&(null===e.balloon.defaults.css&&(e.balloon.defaults.css={}),this.data("options",e.extend(!0,{},e.balloon.defaults,t||{}))),t=this.data("options"),this.each(function(){var s,a;i=e(this),s=!i.data("balloon"),n=i.data("balloon")||e("<div>"),(s||!n.data("active"))&&(n.data("active",!0),clearTimeout(i.data("minLifetime")),a=e.isFunction(t.contents)?t.contents.apply(this):t.contents||(t.contents=i.attr("title")||i.attr("alt")),n.append(a),(t.url||""!==n.html())&&(s||a===n.html()||n.empty().append(a),i.removeAttr("title"),t.url&&n.load(e.isFunction(t.url)?t.url(this):t.url,function(e,s,a){t.ajaxComplete&&t.ajaxComplete(e,s,a),o(i,n,t)}),s?(n.addClass(t.classname).css(t.css||{}).css({visibility:"hidden",position:"absolute"}).appendTo("body"),i.data("balloon",n),o(i,n,t),n.hide().css("visibility","visible")):o(i,n,t),i.data("delay",setTimeout(function(){t.showAnimation?t.showAnimation.apply(n.stop(!0,!0),[t.showDuration,function(){t.showComplete&&t.showComplete.apply(n)}]):n.show(t.showDuration,function(){this.style.removeAttribute&&this.style.removeAttribute("filter"),t.showComplete&&t.showComplete.apply(n)}),t.maxLifetime&&(clearTimeout(i.data("maxLifetime")),i.data("maxLifetime",setTimeout(function(){i.hideBalloon()},t.maxLifetime)))},t.delay))))})},e.fn.hideBalloon=function(){var t=this.data("options");return this.data("balloon")?this.each(function(){var o=e(this);clearTimeout(o.data("delay")),clearTimeout(o.data("minLifetime")),o.data("minLifetime",setTimeout(function(){var i=o.data("balloon");t.hideAnimation?t.hideAnimation.apply(i.stop(!0,!0),[t.hideDuration,function(o){e(this).data("active",!1),t.hideComplete&&t.hideComplete(o)}]):i.stop(!0,!0).hide(t.hideDuration,function(o){e(this).data("active",!1),t.hideComplete&&t.hideComplete(o)})},t.minLifetime))}):this},e.balloon={defaults:{contents:null,url:null,ajaxComplete:null,classname:null,position:"top",offsetX:0,offsetY:0,tipSize:12,delay:0,minLifetime:200,maxLifetime:0,showDuration:100,showAnimation:null,hideDuration:80,hideAnimation:function(e,t){this.fadeOut(e,t)},showComplete:null,hideComplete:null,css:{minWidth:"20px",padding:"5px",borderRadius:"6px",border:"solid 1px #777",boxShadow:"4px 4px 4px #555",color:"#666",backgroundColor:"#efefef",opacity:"0.85",zIndex:"32767",textAlign:"left"}}}}(jQuery);
